---
- name: Check if nginx exists
  stat:
    path: /sbin/nginx
  register: stat_nginx

- name: Install certbot-nginx
  yum:
    name: python2-certbot-nginx
    state: present
  when: stat_nginx.stat.exists
  become: yes

- name: "Obtain/renew SSL cert for {{ domain_name }} (via nginx)"
  command: "certbot certonly -d {{ domain_name }} -m {{ email_address }} --agree-tos -n"
  when: stat_nginx.stat.exists
  become: yes

- name: "Obtain/renew SSL cert for {{ domain_name }} (standalone)"
  command: "certbot certonly --standalone -d {{ domain_name }} -m {{ email_address }} --agree-tos -n"
  when: not stat_nginx.stat.exists
  become: yes
